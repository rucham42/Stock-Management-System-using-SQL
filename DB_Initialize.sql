







---REGIONCODES

SET SERVEROUTPUT ON;
DECLARE
nCount NUMBER;
--nCount1 NUMBER;
BEGIN
SELECT count(*) into nCount FROM user_tables where table_name = 'REGIONCODES';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('REGIONCODES TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE REGIONCODES(
REGCD varchar(10) PRIMARY KEY ,
DES varchar(20) NOT NULL,
TIMEZONE varchar(10),
CONSTRAINT check_tmzone CHECK 
(TIMEZONE IN (''EST'',''IST'',''PST'',''GMT'',''CST'',''SST'')))';

EXECUTE IMMEDIATE 'INSERT INTO REGIONCODES VALUES(''R001'',''NorthAmerica_Est'',''EST'')';
EXECUTE IMMEDIATE 'INSERT INTO REGIONCODES VALUES(''R002'',''NorthAmerica_Pst'',''PST'')';
EXECUTE IMMEDIATE 'INSERT INTO REGIONCODES VALUES(''R003'',''Singapore_Sst'',''SST'')';



END IF;


---ADDRESS


SELECT count(*) into nCount FROM user_tables where table_name = 'ADDRESS';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('ADDRESS TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE ADDRESS(
    ADDR_CODE varchar(10) PRIMARY KEY,-------------------------------------could this be numeric?
    ADDR_COUNTRYNAME varchar(50) NOT NULL,
    ADDR_PROVINCE varchar2(50) NOT NULL,
    CONSTRAINT REGCD
    REGIONCODE varchar(10) REFERENCES REGIONCODES(REGCD))';
    
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A01'',''United States of America'',''Massachusetts'',''R001'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A02'',''United States of America'',''New Hampshire'',''R001'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A03'',''United States of America'',''California'',''R002'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A04'',''United States of America'',''Oregon'',''R002'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A05'',''Singapore'',''North East Community'',''R003'')';
    EXECUTE IMMEDIATE 'INSERT INTO ADDRESS VALUES(''A06'',''Malaysia'',''Johor'',''R003'')';

END IF;


SELECT count(*) into nCount FROM user_tables where table_name = 'CUSTOMER';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('CUSTOMER TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE CUSTOMER(
    CUST_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY  PRIMARY KEY,
    CUST_NAME VARCHAR(20) NOT NULL,
    CUST_CONTACT NUMBER(10) NOT NULL,
    CUST_EMAIL VARCHAR(50) NOT NULL,
    CUST_ACCOUNTNO VARCHAR(20) NOT NULL,
    CONSTRAINT ADDR_CODE
    ADDR VARCHAR(10) REFERENCES ADDRESS(ADDR_CODE),
    CUST_BUYINGPOWER NUMBER(10) NOT NULL,
    CUST_USERNAME VARCHAR(10) NOT NULL,
    CUST_PASSWORD VARCHAR(20) NOT NULL,
    CHECK (CUST_EMAIL LIKE ''%@%com%''))';
    
    select * from customer;
    

  
---INSERT DATA

EXECUTE IMMEDIATE  'INSERT INTO CUSTOMER VALUES(12,''JOHNP'',1469102,''JOHNP@gmail.com'',''10290672'',''A02'',2000,''JOHNP'',''JOHN1123'')';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMER VALUES(1,''JOHN'',1479102,''JOHN@gmail.com'',''10290672'',''A02'',1000,''JOHN'',''JOHN123'')';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMER VALUES(2,''Markian'',1477702,''markian@gmail.com'',''102989372'',''A01'',800,''Markian'',''mark123'')';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMER VALUES(3,''Eddie'',293824,''eddie@gmail.com'',''10290971'',''A05'',10000,''eddie'',''eddie129'')';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMER VALUES(4,''Harrypot'',1098701,''harrypotter@gmail.com'',''09870471'',''A04'',100000,''harryp'',''harry124'')';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMER VALUES(5,''Annie'',1479101,''annie@gmail.com'',''10290671'',''A01'',1000,''annie'',''annie123'')';
EXECUTE IMMEDIATE  'INSERT INTO CUSTOMER VALUES(6,''Mark'',1477701,''mark@gmail.com'',''102989371'',''A03'',900,''Mark'',''mark123'')';
 EXECUTE IMMEDIATE  'INSERT INTO CUSTOMER VALUES(7,''Ed'',293829,''ed@gmail.com'',''10290981'',''A05'',10000,''ed'',''eddie129'')';
 EXECUTE IMMEDIATE  'INSERT INTO CUSTOMER VALUES(8,''Harry'',1098701,''harry@gmail.com'',''09870671'',''A04'',100000,''harry'',''harry123'')';
EXECUTE IMMEDIATE   'INSERT INTO CUSTOMER VALUES(10,''Zac'',1470987,''zac@gmail.com'',''12340671'',''A02'',1870,''zac'',''zacc123'')';


   
END IF;


-- COMPANY TABLE--

SELECT count(*) into nCount FROM user_tables where table_name = 'COMPANY';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('COMPANY TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE '
        CREATE TABLE COMPANY(
        COMPANY_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY,
        COMPANY_NAME VARCHAR2(30) NOT NULL,
        COMPANY_CONTACT NUMBER(10) NOT NULL,
        PRIMARY KEY(COMPANY_ID))';
    
       
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(1,''GOOGLE'',8765435678);';
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(2,''INFOSYS'',8765435679)';
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(3,''META'',8764435678)';
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(4,''TESLA'',8755335678)';
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(5,''FIDELITY'',8755338888)';
       EXECUTE IMMEDIATE 'INSERT INTO COMPANY VALUES(6,''WALLMART'',8755998888)';
        
END IF;


--- STOCK EXCHANGE--
SELECT count(*) into nCount 
FROM user_tables 
WHERE table_name='STOCKEXCHANGE';
IF(nCount>0)
THEN
    DBMS_OUTPUT.PUT_LINE('STOCKEXCHANGE TABLE ALREADY EXISTS');    
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE STOCKEXCHANGE(
    EXCHANGE_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EXCHANGE_NAME VARCHAR(30) NOT NULL,
    COMPANY_ID NUMBER(10) NOT NULL,
    CONSTRAINT COMPANY_ID
    FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(COMPANY_ID))';
    
 EXECUTE IMMEDIATE  'INSERT INTO STOCKEXCHANGE VALUES(1,''NASDAQ'',1)';
 EXECUTE IMMEDIATE   'INSERT INTO STOCKEXCHANGE VALUES(2,''NYSE'',2)';
 EXECUTE IMMEDIATE  'INSERT INTO STOCKEXCHANGE VALUES(3,''BSE'',3)';
 EXECUTE IMMEDIATE  'INSERT INTO STOCKEXCHANGE VALUES(4,''LONDON STOCK EXCHANGE'',4)';
 EXECUTE IMMEDIATE  'INSERT INTO STOCKEXCHANGE VALUES(5,''TOKYO STOCK EXCHANGE'',5)';
COMMIT;
    
    
    

END IF;



--SECURITY EXCHANGE--
SELECT count(*) into nCount FROM user_tables where table_name = 'SECURITYEXCHANGE';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('SECURITYEXCHANGE TABLE ALREADY EXISTS');
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE SECURITYEXCHANGE(
SECURITY_EXCH_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY,
SECURITY_ID NUMBER(10) PRIMARY KEY,
EXCHANGE_ID NUMBER(10) NOT NULL,
CONSTRAINT EXCHANGE_ID
FOREIGN KEY(EXCHANGE_ID) REFERENCES STOCKEXCHANGE(EXCHANGE_ID))';

  EXECUTE IMMEDIATE 'INSERT INTO SECURITYEXCHANGE VALUES (1,1,1)';
 EXECUTE IMMEDIATE  'INSERT INTO SECURITYEXCHANGE VALUES (2,2,2)';
 EXECUTE IMMEDIATE  'INSERT INTO SECURITYEXCHANGE VALUES (3,3,3)';
 EXECUTE IMMEDIATE 'INSERT INTO SECURITYEXCHANGE VALUES (4,4,4)';
 EXECUTE IMMEDIATE  'INSERT INTO SECURITYEXCHANGE VALUES (5,5,5)';
END IF;


--STOCK INFO--
SELECT count(*) into nCount 
FROM user_tables 
WHERE table_name='STOCKINFO';
IF(nCount>0)
THEN
    DBMS_OUTPUT.PUT_LINE('STOCKINFO TABLE ALREADY EXISTS');    
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE STOCKINFO(
    STOCK_ID number(10) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AS_OF_DATE DATE UNIQUE,
    MARKET_VAL NUMBER(10),
    STOCK_QTY_AVAILABLE NUMBER(10),
    CONSTRAINT check_date CHECK (extract(day from AS_OF_DATE) = 1))';
    
   EXECUTE IMMEDIATE   'INSERT INTO STOCKINFO VALUES(6,TO_DATE(''2005/05/06'', ''yyyy/mm/dd''), 10000,50)';
   EXECUTE IMMEDIATE   'INSERT INTO STOCKINFO VALUES(2,TO_DATE(''2012/06/04'', ''yyyy/mm/dd''), 6000,5)';
  EXECUTE IMMEDIATE  'INSERT INTO STOCKINFO VALUES(3,TO_DATE(''2019/12/09'', ''yyyy/mm/dd''), 80000,60)';
  EXECUTE IMMEDIATE  'INSERT INTO STOCKINFO VALUES(4,TO_DATE(''2020/11/12'', ''yyyy/mm/dd''), 900,80)';
  EXECUTE IMMEDIATE   'INSERT INTO STOCKINFO VALUES(5,TO_DATE(''2021/08/05'', ''yyyy/mm/dd''), 300,5)';
    

END IF;



--- SECURITY TYPE
SELECT count(*) into nCount FROM user_tables where table_name = 'SECURITYTYPE';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('SECURITYTYPE TABLE ALREADY EXISTS');
ELSE
        EXECUTE IMMEDIATE 'CREATE TABLE SECURITYTYPE(
      SECURITY_TYPE VARCHAR(20) NOT NULL,
     SECURITYTYPE_DESC VARCHAR(20) NOT NULL,
      PRIMARY KEY (SECURITY_TYPE)
    )';
EXECUTE IMMEDIATE 'INSERT INTO SECURITYTYPE VALUES(''CB'',''CORPORATE BOND'')';
EXECUTE IMMEDIATE 'INSERT INTO SECURITYTYPE VALUES(''BN'',''BANK NOTE'')';
EXECUTE IMMEDIATE 'INSERT INTO SECURITYTYPE VALUES(''EQF'',''EQUITY FUTURE'')';
EXECUTE IMMEDIATE 'INSERT INTO SECURITYTYPE VALUES(''FUT'',''FUTURE'')';
EXECUTE IMMEDIATE 'INSERT INTO SECURITYTYPE VALUES(''CDTY'',''COMMODITY'')'; 
   
END IF;



-- COMPANYSECURITY--
SELECT count(*) into nCount FROM user_tables where table_name = 'COMPANYSECURITY';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('COMPANYSECURITY TABLE ALREADY EXISTS');
ELSE
     EXECUTE IMMEDIATE 'CREATE TABLE COMPANYSECURITY(
    COMPANY_ID NUMBER(10) NOT NULL,
    SECURITY_ID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY ,
    STOCK_ID NUMBER(10) NOT NULL,
    REG_CD VARCHAR(10) ,
    SEC_TYPE VARCHAR(20),
    PRIMARY KEY(SECURITY_ID),
    CONSTRAINT COMPANY_ID
    FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(COMPANY_ID),
    CONSTRAINT STOCK_ID
    FOREIGN KEY(STOCK_ID) REFERENCES STOCKINFO(STOCK_ID),
    CONSTRAINT REG_CD
    FOREIGN KEY(REG_CD) REFERENCES REGIONCODES(REGCD),
    CONSTRAINT SEC_TYPE
    FOREIGN KEY(SEC_TYPE) REFERENCES SECURITYTYPE(SECURITY_TYPE))';
    
EXECUTE IMMEDIATE 'INSERT INTO COMPANYSECURITY VALUES (1,1,1,''R001'',''CB'')';
EXECUTE IMMEDIATE 'INSERT INTO COMPANYSECURITY VALUES (2,2,2,''R002'',''BN'')';
EXECUTE IMMEDIATE 'INSERT INTO COMPANYSECURITY VALUES (3,3,3,''R003'',''BN'')';
EXECUTE IMMEDIATE 'INSERT INTO COMPANYSECURITY VALUES (4,4,4,''R002'',''FUT'')';
EXECUTE IMMEDIATE 'INSERT INTO COMPANYSECURITY VALUES (5,5,5,''R003'',''CDTY'')';
    
END IF;


--- CUSTOMERHOLDINGS---
SELECT count(*) into nCount FROM user_tables where table_name = 'CUSTOMERHOLDING';
IF(nCount > 0)
THEN
    DBMS_OUTPUT.PUT_LINE('CUSTOMERHOLDING TABLE ALREADY EXISTS');
ELSE
     EXECUTE IMMEDIATE 'CREATE TABLE CUSTOMERHOLDING(
    HOLDINGID NUMBER(10) GENERATED BY DEFAULT AS IDENTITY  PRIMARY KEY,
    CONSTRAINT SECURITY_ID
    SECURITYID  NUMBER(10)  REFERENCES COMPANYSECURITY(SECURITY_ID) NOT NULL,
    QTY	VARCHAR(30)	UNIQUE  NOT NULL,
    CONSTRAINT CUST_ID
    CUSTOMERID	NUMBER(10)	 REFERENCES CUSTOMER(CUST_ID) NOT NULL,
    COMPANYID	NUMBER	NOT NULL,
    asofdate  DATE )';
    
--- INSERT DATA  CUSTOMERHOLDING---
 EXECUTE IMMEDIATE 'INSERT INTO CUSTOMERHOLDING(SECURITYID,QTY,CUSTOMERID,COMPANYID,asofdate) VALUES(1,3,1,1,SYSDATE)';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMERHOLDING(SECURITYID,QTY,CUSTOMERID,COMPANYID,asofdate) VALUES(2,4,2,2,SYSDATE)';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMERHOLDING(SECURITYID,QTY,CUSTOMERID,COMPANYID,asofdate) VALUES(3,5,3,3,SYSDATE)';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMERHOLDING(SECURITYID,QTY,CUSTOMERID,COMPANYID,asofdate) VALUES(4,6,4,4,SYSDATE)';
EXECUTE IMMEDIATE 'INSERT INTO CUSTOMERHOLDING(SECURITYID,QTY,CUSTOMERID,COMPANYID,asofdate) VALUES(5,7,5,5,SYSDATE)';
COMMIT;
  
    
END IF;



SELECT count(*) into nCount 
FROM user_tables 
WHERE table_name='TRANSACTION';
IF(nCount>0)
THEN
    DBMS_OUTPUT.PUT_LINE('TRANSACTION TABLE ALREADY EXISTS');    
ELSE
    EXECUTE IMMEDIATE 'CREATE TABLE TRANSACTION(
      TXN_ID NUMBER(10)  GENERATED BY DEFAULT AS IDENTITY ,
      TXN_TYPE VARCHAR(30) NOT NULL,
      CUSTOMER_ID NUMBER(10) NOT NULL,
      STOCK_ID NUMBER(10) NOT NULL,
      QTY NUMBER(10) NOT NULL,
      PRICE NUMBER(10),
      TXN_DATE DATE,
      TXN_TIME TIMESTAMP,
      PRIMARY KEY(TXN_ID),
      CONSTRAINT CUST_IDTRANSACTION
      FOREIGN KEY(CUSTOMER_ID)REFERENCES CUSTOMER(CUST_ID),
      CONSTRAINT STOCK_IDTRANSACTION
      FOREIGN KEY(STOCK_ID) REFERENCES STOCKINFO(STOCK_ID))';

EXECUTE IMMEDIATE 'INSERT INTO TRANSACTION(TXN_TYPE,CUSTOMER_ID,STOCK_ID,QTY,PRICE,TXN_DATE,TXN_TIME) VALUES(''S'',1,1,2,80,SYSDATE ,CURRENT_TIMESTAMP)';
EXECUTE IMMEDIATE 'INSERT INTO TRANSACTION(TXN_TYPE,CUSTOMER_ID,STOCK_ID,QTY,PRICE,TXN_DATE,TXN_TIME) VALUES(''S'',2,2,3,300,SYSDATE,CURRENT_TIMESTAMP)';
EXECUTE IMMEDIATE 'INSERT INTO TRANSACTION(TXN_TYPE,CUSTOMER_ID,STOCK_ID,QTY,PRICE,TXN_DATE,TXN_TIME) VALUES(''S'',3,3,5,220,SYSDATE,CURRENT_TIMESTAMP)';
EXECUTE IMMEDIATE 'INSERT INTO TRANSACTION(TXN_TYPE,CUSTOMER_ID,STOCK_ID,QTY,PRICE,TXN_DATE,TXN_TIME) VALUES(''S'',4,4,8,600,SYSDATE,CURRENT_TIMESTAMP)';
EXECUTE IMMEDIATE 'INSERT INTO TRANSACTION(TXN_TYPE,CUSTOMER_ID,STOCK_ID,QTY,PRICE,TXN_DATE,TXN_TIME) VALUES(''S'',5,5,12,300,SYSDATE,CURRENT_TIMESTAMP)';
END IF;
COMMIT;
END;